# üé∞ CrazyGift Backend API Documentation

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**Base URL:** `http://localhost:8000/api`  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ü—Ä–æ—Ç–æ–∫–æ–ª:** HTTP/HTTPS  
**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:** JSON  

### –°—Ç–∞—Ç—É—Å—ã –æ—Ç–≤–µ—Ç–æ–≤
- `200` - –£—Å–ø–µ—à–Ω–æ
- `201` - –°–æ–∑–¥–∞–Ω–æ
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `404` - –ù–µ –Ω–∞–π–¥–µ–Ω–æ
- `422` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏
```json
{
  "error": "Error Type",
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
  "details": {
    "field": "–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏"
  }
}
```

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### POST `/users/auth`
–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Telegram WebApp

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "init_data": "query_id=AAHdF6IQAAAAAN0XohDhrOrc&user=%7B%22id%22%3A279058397..."
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "user": {
    "id": 1,
    "telegram_id": 279058397,
    "username": "johndoe",
    "first_name": "John",
    "last_name": "Doe",
    "balance_stars": 100,
    "balance_ton": "0.000000000",
    "referral_code": "CG123456",
    "total_cases_opened": 0,
    "created_at": "2025-08-09T04:36:01.000Z",
    "last_active": "2025-08-09T04:36:01.000Z"
  }
}
```

---

## üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

### GET `/users/{user_id}/profile`
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (path) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "telegram_id": 279058397,
  "username": "johndoe",
  "first_name": "John",
  "last_name": "Doe",
  "balance_stars": 1500,
  "balance_ton": "0.000000000",
  "referral_code": "CG123456",
  "total_cases_opened": 5,
  "total_spent_stars": 750,
  "total_earned_stars": 2250,
  "created_at": "2025-08-09T04:36:01.000Z",
  "last_active": "2025-08-09T04:36:01.000Z"
}
```

### PUT `/users/{user_id}/profile`
–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "username": "newusername",
  "first_name": "NewName"
}
```

### GET `/users/{user_id}/balance`
–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "balance_stars": 1500,
  "balance_ton": 0.0,
  "user_id": 1
}
```

### GET `/users/{user_id}/stats`
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "user_id": 1,
  "total_cases_opened": 5,
  "total_spent_stars": 750,
  "total_earned_stars": 2250,
  "inventory": {
    "total_items": 12,
    "common_items": 8,
    "rare_items": 3,
    "epic_items": 1,
    "legendary_items": 0,
    "mythic_items": 0
  },
  "transactions": {
    "total_purchases": 5,
    "total_spent": 750.0,
    "total_earned": 1200.0
  },
  "referrals_count": 3,
  "member_since": "2025-08-09T04:36:01.000Z",
  "last_active": "2025-08-09T04:36:01.000Z"
}
```

### GET `/users/{user_id}/history`
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `transaction_type` (optional) - –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `currency` (optional) - –í–∞–ª—é—Ç–∞ (STARS, TON)
- `status` (optional) - –°—Ç–∞—Ç—É—Å (pending, completed, failed)
- `limit` (optional, default: 50) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- `offset` (optional, default: 0) - –°–º–µ—â–µ–Ω–∏–µ

**–û—Ç–≤–µ—Ç:**
```json
{
  "transactions": [
    {
      "id": 1,
      "user_id": 1,
      "type": "case_purchase",
      "amount": "150.000000000",
      "currency": "STARS",
      "status": "completed",
      "external_id": null,
      "description": "Opened case: Telegram Case #1",
      "created_at": "2025-08-09T04:36:01.000Z",
      "completed_at": "2025-08-09T04:36:01.000Z"
    }
  ],
  "total": 10,
  "has_more": false
}
```

### GET `/users/{user_id}/referrals`
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "referral_code": "CG123456",
  "referral_link": "https://t.me/your_bot?start=ref_CG123456",
  "total_referrals": 3,
  "active_referrals": 2,
  "referrals": [
    {
      "id": 2,
      "name": "Jane Doe",
      "username": "janedoe",
      "joined_at": "2025-08-09T05:00:00.000Z",
      "cases_opened": 2,
      "last_active": "2025-08-09T06:00:00.000Z",
      "is_active": true
    }
  ]
}
```

---

## üéÅ –ö–µ–π—Å—ã

### GET `/cases/`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–µ–π—Å–æ–≤

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `category` (optional) - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∫–µ–π—Å–∞
- `active_only` (optional, default: true) - –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–µ–π—Å—ã

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "name": "Telegram Case #1",
    "description": "–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏",
    "price_stars": 150,
    "image_url": "assets/cases/case1.png",
    "category": "basic",
    "active": true,
    "total_opened": 25,
    "created_at": "2025-08-09T04:36:01.000Z"
  }
]
```

### GET `/cases/{case_id}`
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ–π—Å–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "name": "Telegram Case #1",
  "description": "–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏",
  "price_stars": 150,
  "image_url": "assets/cases/case1.png",
  "category": "basic",
  "active": true,
  "total_opened": 25,
  "created_at": "2025-08-09T04:36:01.000Z",
  "items": [
    {
      "id": 1,
      "name": "Blue Bow Tie",
      "value": 25.6,
      "stars": 2556,
      "rarity": "common",
      "weight": 40,
      "image": "assets/gifts/gift2.png"
    }
  ]
}
```

### POST `/cases/{case_id}/open`
–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 1
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "item": {
    "id": 1,
    "user_id": 1,
    "item_name": "Blue Bow Tie",
    "item_value": "25.60",
    "item_stars": 2556,
    "rarity": "common",
    "image_url": "assets/gifts/gift2.png",
    "case_name": "Telegram Case #1",
    "is_withdrawn": false,
    "is_upgraded": false,
    "created_at": "2025-08-09T04:36:01.000Z"
  },
  "new_balance": 1350,
  "message": "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏: Blue Bow Tie"
}
```

**–û—Ç–≤–µ—Ç (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤):**
```json
{
  "success": false,
  "new_balance": 100,
  "message": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥. –ù—É–∂–Ω–æ: 150, —É –≤–∞—Å: 100"
}
```

### GET `/cases/categories`
–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–µ–π—Å–æ–≤

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "name": "basic",
    "count": 2,
    "display_name": "–ë–∞–∑–æ–≤—ã–µ"
  },
  {
    "name": "premium",
    "count": 1,
    "display_name": "–ü—Ä–µ–º–∏—É–º"
  }
]
```

### GET `/cases/stats`
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–µ–π—Å–æ–≤

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_cases": 3,
  "total_opened": 127,
  "popular_case": {
    "name": "Telegram Case #1",
    "times_opened": 89
  },
  "price_range": {
    "min": 150,
    "max": 500,
    "average": 300.0
  }
}
```

---

## üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å

### GET `/inventory/{user_id}`
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `rarity` (optional) - –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
- `include_withdrawn` (optional, default: false) - –í–∫–ª—é—á–∏—Ç—å –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
- `limit` (optional, default: 100) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- `offset` (optional, default: 0) - –°–º–µ—â–µ–Ω–∏–µ

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "user_id": 1,
    "item_name": "Blue Bow Tie",
    "item_value": "25.60",
    "item_stars": 2556,
    "rarity": "common",
    "image_url": "assets/gifts/gift2.png",
    "case_name": "Telegram Case #1",
    "is_withdrawn": false,
    "is_upgraded": false,
    "created_at": "2025-08-09T04:36:01.000Z"
  }
]
```

### GET `/inventory/{user_id}/stats`
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_items": 12,
  "portfolio_value": 450.75,
  "portfolio_stars": 45075,
  "withdrawn_items": 2,
  "by_rarity": {
    "common": {
      "count": 8,
      "total_value": 200.50,
      "total_stars": 20050
    },
    "rare": {
      "count": 3,
      "total_value": 180.25,
      "total_stars": 18025
    }
  },
  "most_valuable_item": {
    "name": "Golden Star",
    "value": 125.0,
    "rarity": "epic"
  }
}
```

### POST `/inventory/{item_id}/sell`
–ü—Ä–æ–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 1
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "stars_earned": 2556,
  "new_balance": 3906,
  "message": "–ü—Ä–µ–¥–º–µ—Ç 'Blue Bow Tie' –ø—Ä–æ–¥–∞–Ω –∑–∞ 2,556 –∑–≤—ë–∑–¥"
}
```

### POST `/inventory/{item_id}/withdraw`
–ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–∞

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 1,
  "contact_info": "telegram: @johndoe"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–∞ 'Golden Star' –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤."
}
```

### GET `/inventory/{user_id}/withdrawals`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥

**–û—Ç–≤–µ—Ç:**
```json
{
  "withdrawn_items": [
    {
      "id": 5,
      "name": "Golden Star",
      "value": 125.0,
      "stars": 12500,
      "rarity": "epic",
      "requested_at": "2025-08-09T06:00:00.000Z",
      "status": "pending"
    }
  ],
  "transactions": [
    {
      "id": 10,
      "amount": 12500.0,
      "status": "pending",
      "description": "Withdrawal request: Golden Star",
      "created_at": "2025-08-09T06:00:00.000Z",
      "completed_at": null
    }
  ]
}
```

### DELETE `/inventory/{item_id}`
–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç (–∞–¥–º–∏–Ω)

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Item 'Blue Bow Tie' deleted successfully"
}
```

---

## üí∞ –ü–ª–∞—Ç–µ–∂–∏

### POST `/payments/ton/deposit`
–°–æ–∑–¥–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç TON

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 1,
  "amount": 1.5
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "transaction_id": 15,
  "ton_transaction": {
    "valid_until": 1691568961,
    "messages": [
      {
        "address": "EQD...wallet_address",
        "amount": "1500000000",
        "payload": "deposit_1_150"
      }
    ]
  }
}
```

### POST `/payments/stars/invoice`
–°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å –¥–ª—è Stars

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 1,
  "stars_amount": 1000
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "invoice_link": "https://t.me/invoice/abcd1234...",
  "transaction_id": 16
}
```

### POST `/payments/webhook/ton`
Webhook –¥–ª—è TON –ø–ª–∞—Ç–µ–∂–µ–π

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "transaction_id": 15,
  "tx_hash": "abc123def456..."
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Payment verification started",
  "data": {
    "transaction_id": 15
  }
}
```

### POST `/payments/webhook/telegram`
Webhook –¥–ª—è Telegram –ø–ª–∞—Ç–µ–∂–µ–π

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "transaction_id": 16,
  "payment_id": "tg_payment_123",
  "status": "paid"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Payment verification started",
  "data": {
    "transaction_id": 16
  }
}
```

### GET `/payments/transaction/{transaction_id}`
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 15,
  "user_id": 1,
  "type": "deposit_ton",
  "amount": "1.500000000",
  "currency": "TON",
  "status": "completed",
  "external_id": "abc123def456...",
  "description": "TON deposit: 1.5 TON",
  "created_at": "2025-08-09T06:00:00.000Z",
  "completed_at": "2025-08-09T06:05:00.000Z"
}
```

---

## üìä –°–∏—Å—Ç–µ–º–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### GET `/`
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ API

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "CrazyGift API is running",
  "version": "1.0.0",
  "status": "healthy",
  "docs": "/docs"
}
```

### GET `/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "timestamp": 1691565961.123,
  "version": "1.0.0"
}
```

### GET `/api/stats`
–ü—É–±–ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_users": 1250,
  "total_cases_opened": 8934,
  "active_cases": 3,
  "online_now": "~300"
}
```

---

## üìù –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### User
```json
{
  "id": "integer",
  "telegram_id": "integer",
  "username": "string|null",
  "first_name": "string|null", 
  "last_name": "string|null",
  "balance_stars": "integer",
  "balance_ton": "decimal(18,9)",
  "referral_code": "string|null",
  "referred_by": "integer|null",
  "total_cases_opened": "integer",
  "total_spent_stars": "integer",
  "total_earned_stars": "integer",
  "created_at": "datetime",
  "updated_at": "datetime",
  "last_active": "datetime"
}
```

### InventoryItem
```json
{
  "id": "integer",
  "user_id": "integer",
  "item_name": "string",
  "item_value": "decimal(10,2)",
  "item_stars": "integer",
  "rarity": "string",
  "image_url": "string|null",
  "case_name": "string|null",
  "case_id": "integer|null",
  "is_withdrawn": "boolean",
  "is_upgraded": "boolean",
  "withdrawal_requested_at": "datetime|null",
  "created_at": "datetime"
}
```

### Transaction
```json
{
  "id": "integer",
  "user_id": "integer",
  "type": "string",
  "amount": "decimal(18,9)",
  "currency": "string",
  "status": "string",
  "external_id": "string|null",
  "description": "string|null",
  "extra_data": "string|null",
  "created_at": "datetime",
  "completed_at": "datetime|null"
}
```

### Case
```json
{
  "id": "integer",
  "name": "string",
  "description": "string|null",
  "price_stars": "integer",
  "items": "string", // JSON
  "active": "boolean",
  "image_url": "string|null",
  "category": "string|null",
  "total_opened": "integer",
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

---

## üî§ –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è

### –¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `deposit_ton` - –î–µ–ø–æ–∑–∏—Ç TON
- `deposit_stars` - –î–µ–ø–æ–∑–∏—Ç Stars
- `case_purchase` - –ü–æ–∫—É–ø–∫–∞ –∫–µ–π—Å–∞
- `item_sale` - –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
- `item_withdrawal` - –í—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–∞
- `referral_bonus` - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å

### –°—Ç–∞—Ç—É—Å—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `pending` - –û–∂–∏–¥–∞–Ω–∏–µ
- `processing` - –û–±—Ä–∞–±–æ—Ç–∫–∞
- `completed` - –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- `failed` - –ù–µ—É–¥–∞—á–∞
- `cancelled` - –û—Ç–º–µ–Ω–µ–Ω–æ

### –†–µ–¥–∫–æ—Å—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- `common` - –û–±—ã—á–Ω—ã–π
- `rare` - –†–µ–¥–∫–∏–π
- `epic` - –≠–ø–∏—á–µ—Å–∫–∏–π
- `legendary` - –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π
- `mythic` - –ú–∏—Ñ–∏—á–µ—Å–∫–∏–π

### –í–∞–ª—é—Ç—ã
- `STARS` - Telegram Stars
- `TON` - TON Coin

---

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### JavaScript (Frontend)
```javascript
class CrazyGiftAPI {
  constructor(baseURL = 'http://localhost:8000/api') {
    this.baseURL = baseURL;
  }

  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const response = await fetch(url, {
      headers: { 'Content-Type': 'application/json' },
      ...options
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    return response.json();
  }

  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
  async auth(initData) {
    return this.request('/users/auth', {
      method: 'POST',
      body: JSON.stringify({ init_data: initData })
    });
  }

  // –û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å
  async openCase(caseId, userId) {
    return this.request(`/cases/${caseId}/open`, {
      method: 'POST',
      body: JSON.stringify({ user_id: userId })
    });
  }

  // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
  async getInventory(userId) {
    return this.request(`/inventory/${userId}`);
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const api = new CrazyGiftAPI();
const user = await api.auth(telegramInitData);
const result = await api.openCase(1, user.id);
```

### Python (Backend integration)
```python
import httpx

class CrazyGiftAPI:
    def __init__(self, base_url="http://localhost:8000/api"):
        self.base_url = base_url
    
    async def get_user_stats(self, user_id: int):
        async with httpx.AsyncClient() as client:
            response = await client.get(f"{self.base_url}/users/{user_id}/stats")
            return response.json()
    
    async def create_ton_deposit(self, user_id: int, amount: float):
        async with httpx.AsyncClient() as client:
            response = await client.post(
                f"{self.base_url}/payments/ton/deposit",
                json={"user_id": user_id, "amount": amount}
            )
            return response.json()
```

### cURL –ø—Ä–∏–º–µ—Ä—ã
```bash
# –ü–æ–ª—É—á–∏—Ç—å –∫–µ–π—Å—ã
curl -X GET "http://localhost:8000/api/cases/"

# –û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å
curl -X POST "http://localhost:8000/api/cases/1/open" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 1}'

# –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
curl -X GET "http://localhost:8000/api/users/1/balance"

# –ü—Ä–æ–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç
curl -X POST "http://localhost:8000/api/inventory/5/sell" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 1}'
```

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ª–∏–º–∏—Ç—ã

### Rate Limiting
- **API –∑–∞–ø—Ä–æ—Å—ã:** 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É –Ω–∞ IP
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** 10 –ø–æ–ø—ã—Ç–æ–∫/–º–∏–Ω—É—Ç—É –Ω–∞ IP
- **–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–æ–≤:** 60 –æ—Ç–∫—Ä—ã—Ç–∏–π/–º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –õ–∏–º–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö
- **TON –¥–µ–ø–æ–∑–∏—Ç:** 0.01 - 1000 TON
- **Stars –¥–µ–ø–æ–∑–∏—Ç:** 1 - 100,000 Stars
- **–í—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:** –º–∏–Ω–∏–º—É–º 1000 Stars
- **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** –º–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø–∏—Å–µ–π –∑–∞ –∑–∞–ø—Ä–æ—Å

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- **Username:** 3-30 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã/_-
- **–ò–º–µ–Ω–∞:** –º–∞–∫—Å–∏–º—É–º 255 —Å–∏–º–≤–æ–ª–æ–≤
- **–û–ø–∏—Å–∞–Ω–∏—è:** –º–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤

---

## üêõ –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----|----------|---------|
| `USER_NOT_FOUND` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω | `{"error": "USER_NOT_FOUND", "message": "User not found"}` |
| `INSUFFICIENT_BALANCE` | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ | `{"error": "INSUFFICIENT_BALANCE", "message": "Not enough stars"}` |
| `ITEM_NOT_FOUND` | –ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω | `{"error": "ITEM_NOT_FOUND", "message": "Item not found or withdrawn"}` |
| `CASE_INACTIVE` | –ö–µ–π—Å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω | `{"error": "CASE_INACTIVE", "message": "Case is not active"}` |
| `TRANSACTION_FAILED` | –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | `{"error": "TRANSACTION_FAILED", "message": "Payment processing failed"}` |
| `INVALID_AUTH` | –ù–µ–≤–µ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | `{"error": "INVALID_AUTH", "message": "Invalid Telegram auth data"}` |
| `RATE_LIMIT` | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç | `{"error": "RATE_LIMIT", "message": "Too many requests"}` |

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**Swagger UI:** `http://localhost:8000/docs`  
**ReDoc:** `http://localhost:8000/redoc`  
**–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥:** [GitHub Repository]  
**–í–µ—Ä—Å–∏—è API:** 1.0.0  

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 9 –∞–≤–≥—É—Å—Ç–∞ 2025*